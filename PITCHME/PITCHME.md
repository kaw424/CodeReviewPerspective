<!-- ---?color=#222222 -->

### コードを観る視点

#### 「将来を見据えた息の長いコードを残す」ための<br>　判断基準<br><br>

<div style="text-align: right;">
白井 誠  

[@fa[github]@shirai](https://github.com/shirai)  
[@fa[twitter]@shirai_makoto](https://twitter.com/shirai_makoto)
</div>

---

#### ＜今回のテーマ＞

## <font color="yellow">ソースコードレビュー</font>

@ul[squares]

- 私が何を見てレビューしているのか？
- 対応方針をどう決めているのか？

@ulend

---

レビュー時はもちろん  
**コーディング時にも参考にしていただきたいです！**

---

唐突ですが

---

私が

### これまで触ってきた言語一覧

を紹介します

---

### これまで触ってきた言語一覧

| 現場 | 言語
|:--|:--
|iOSアプリ開発|Swift, Objective-C
|Androidアプリ開発|Java
|Webサイト開発|Java, JavaScript, PHP
|Webバックエンド開発|Perl, Bash
|Windowsパッケージソフトウェア開発|Visual Basic .NET
|Windowsクライアントアプリ開発|C++, C#
|組み込み|C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript

---

## どの現場で活かせる？

---

| 現場 | 言語
|:--|:--
|iOSアプリ開発|Swift, Objective-C
|Androidアプリ開発|Java
|Webサイト開発|Java, JavaScript, PHP
|Webバックエンド開発|Perl, Bash
|Windowsパッケージソフトウェア開発|Visual Basic .NET
|Windowsクライアントアプリ開発|C++, C#
|組み込み|C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript

---

| 現場 | 言語
|:--|:--
|<font color="red">iOSアプリ開発|<font color="red">Swift, Objective-C
|<font color="red">Androidアプリ開発|<font color="red">Java
|<font color="red">Webサイト開発|<font color="red">Java, JavaScript, PHP
|<font color="red">Webバックエンド開発|<font color="red">Perl, Bash
|<font color="red">Windowsパッケージソフトウェア開発|<font color="red">Visual Basic .NET
|<font color="red">Windowsクライアントアプリ開発|<font color="red">C++, C#
|<font color="red">組み込み|<font color="red">C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript


---

言語・フレームワーク問わず、  

## <font color="yellow">全てのレビューに使える話！</font>

@ul[squares]

- Ruby, Pythonでは使えないわけではないです
- **「趣味」** で一人で開発する時はあまり向かないだけ

@ulend

---

## <font color="red">注意点</font>

今回紹介するのは  
**「言語・フレームワークに依存しない観点」だけ**  
です

@ul[squares]

- 今回の内容を抑えればレビュアになれる、というわけでない
- 言語・フレームワーク特有の観点ももちろん必要
- 業務知見や過去不具合の知見とかも

@ulend

---

### 言語・フレームワーク問わない観点って何？

---

## 概要

<!--
良いプログラマになるための観点

- 改善のしやすいコードが「書ける」
- 改善のしにくいコードに「指摘できる」

### こんなことない？

- コーディング時
  - どこを修正すれば良いのかわからない
  - 修正すると動かない、予想外のところが動かなくなる
  - 仕様変更が入ると、その部分が全て書き直しになる
- レビュー時
  - レビューで処理内容の説明を多く求められる
  - 「わかりにくい」「美しくない」と言われる
- リリース後
  - 障害が発生する（動作が遅い、すぐ落ちる）

// 今回は「レビューにスコープを当てるのでケースを変更する
-->

1. レビューの時に何を見ているのか？
2. 許容する指摘/許容しない指摘 の判断軸は何か？

### どうやって解決する？

"プログラミングの原理原則" から特に重視しているものを取り上げつつ、
「将来を見据えた息の長いコードを残す」ための判断基準を紹介します。
レビュー時はもちろんコーディングする機会にも参考にしていただきたいです。

### 抑えるべきポイント

しっかりした価値観を持て

（「SEを極める50の鉄則 第１章 信頼されるSEへの道」より）

第一線のSEはしっかりとした考え方・価値観を持たなければならない

- SEのあり方
- 顧客やビジネスに対する姿勢
- システム開発・導入のやり方
  など

- 若い時の経験がカギ
- 普遍的な価値観を身に付けよ

### 話の流れ

1. 事実パート
   各種書籍で謳われている「事実（普遍的な価値観）」をいくつか紹介します。
   がっつり説明すると超大作になってしまうので、後半のインプット程度の内容です
2. 白井論パート
  諸々の書籍などのインプットと「経験」から私がどんな行動をしているかを紹介します。
  私なりの解釈や経験を元にしているので、この辺は環境だったりで左右されるところが大きいと思いますが、
  書籍に抽象的に書かれている事実からアクションに落として、少しでもイメージ・行動しやすくするために紹介します。

## 可逆性

### 「UNDO」可能な選択をする

### 最終決定などない

### 特定技術に依存しない

### アーキテクチャの可逆性

## コードの臭い

### コードの凶兆を見逃さない

### 嗅覚はリファクタリングの必要条件

### 臭いの傾向を知る

- よく見る
- 大きすぎる
- 長すぎる
- 名前が合わない

## 技術的負債

### 問題コードは「借金」である

### 問題コードとうまく付き合う方法

### 問題コードを管理する

### ＋１：コードをきれいにする意義を説明

### ＋１：問題コードの問題コードの誘因

#### 要素

- 経験不足のプログラマ
- 締め切りのフレッシャー
- 読みにくいコード
- 特殊化されたコード
- 不要に複雑なコード
- 単に悪い設計

#### チームの文化

- きれいなコードを書こうとしない
- 不明瞭なコードがあっても受け入れてしまう
- リファクタリングに時間を割かない
- リリース直前になって回帰テストを実行する
- 膨大な依存性を抱えた古いシステムのリプレースを躊躇する
- 安易にコードをブランチさせる

### 関連：技術的病気

「病気のソフトウェア」
→ 変更すると、関連のない別の箇所が壊れてしまう状態
    放っておいても治らずに悪化するばかり
    → 「手術」（リファクタリング）を行う必要がある。

#### リファクタリング

- 時間と労力はかかるが、PJが進む中で、その投資は十分回収できる（むしろ何倍もの利益となる）
- メンバーの経験にもなる
  - 「あるべき」を学べるので、エキスパートになっていく
- ただし、改良はゆっくり少しずつ行い、都度テストする
  - 一度に大幅な変更を加えると、それが元で大変な問題が発生することがある
    - 最悪「全部切り戻し」もあり得る。。。

### 関連： 暫定ソリューション

よくある「暫定対応」

急ぎでやるので本来守るべき規約やガイドラインに従うことができていないことが多い
→ 「あとで直す」という前提で進めているところが多いはず

ところが、暫定ソリューションには「慣性の法則」が働く（既成事実と化す）
下記理由で「直す必要性」を感じられず今すぐ変えようと動き出さず、
結果「その場しのぎ」のはずのコードが長生きする

- 今動いている
- 一応役になっている
- 一応みんなに認められている

とはいえ暫定ソリューションを初めから一切作らない、というのは現実的に無理
（問題解決間に合わない、とかどうしても起きる）

→ 技術的負債と同様に管理してあげて、原則「素早く直す」こと
（障害とかが発生した直後が一番。担当者離任とかのリスクもあるし）

## エンディング