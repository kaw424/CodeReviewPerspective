<!-- ---?color=#222222 -->

### コードを観る視点

#### 「将来を見据えた息の長いコードを残す」ための<br>　判断基準<br><br>

<div style="text-align: right;">
白井 誠  

[@fa[github]@shirai](https://github.com/shirai)  
[@fa[twitter]@shirai_makoto](https://twitter.com/shirai_makoto)
</div>

---

#### ＜今回のテーマ＞

## <div style="text-align: center;"><font color="yellow">ソースコードレビュー</font></div>

@ul[squares]

- 私が何を見てレビューしているのか？
- 対応方針をどう決めているのか？

@ulend

---

レビュー時はもちろん  
**コーディング時にも参考にしていただきたいです！**

---

唐突ですが

---

私が

### これまで触ってきた言語一覧

を紹介します

---

### これまで触ってきた言語一覧

| 現場 | 言語
|:--|:--
|iOSアプリ開発|Swift, Objective-C
|Androidアプリ開発|Java
|Webサイト開発|Java, JavaScript, PHP
|Webバックエンド開発|Perl, Bash
|Windowsパッケージソフトウェア開発|Visual Basic .NET
|Windowsクライアントアプリ開発|C++, C#
|組み込み|C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript

---

そこそこバリエーションありますね。
では、

## どの現場で活かせる話が始まる？

---

| 現場 | 言語
|:--|:--
|iOSアプリ開発|Swift, Objective-C
|Androidアプリ開発|Java
|Webサイト開発|Java, JavaScript, PHP
|Webバックエンド開発|Perl, Bash
|Windowsパッケージソフトウェア開発|Visual Basic .NET
|Windowsクライアントアプリ開発|C++, C#
|組み込み|C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript

---

| 現場 | 言語
|:--|:--
|<font color="red">iOSアプリ開発|<font color="red">Swift, Objective-C
|<font color="red">Androidアプリ開発|<font color="red">Java
|<font color="red">Webサイト開発|<font color="red">Java, JavaScript, PHP
|<font color="red">Webバックエンド開発|<font color="red">Perl, Bash
|<font color="red">Windowsパッケージソフトウェア開発|<font color="red">Visual Basic .NET
|<font color="red">Windowsクライアントアプリ開発|<font color="red">C++, C#
|<font color="red">組み込み|<font color="red">C

|（趣味）
|:--|:--
|Ruby, Python, Kotlin, ActionScript, AppleScript

---

# <div style="text-align: center;"><font color="red">！！！</font></div>

---

言語・フレームワーク問わず、  

### <font color="yellow">どんな現場でも使える話！</font>

@ul[squares]

- Ruby, Pythonでは使えないわけではないです
- **「趣味」** で個人開発する時はあまり向かないだけ

@ulend

---

## 今回の話のターゲット

@ul[squares]

- レビュア経験の少ない **次期アーキテクト候補**
- レビュー指摘対応が長引く **若手エンジニア**

@ulend

---

### 今回のキーワード

# プリンシプル

> プログラミングの指針となる「前提」「原則」「思想」「習慣」「視点」「手法」「法則」などのことです。  
（「プリンシプル オブ プログラミング」より）

今回は「視点」にフォーカスを当てたお話になります。

---

### 紹介するプリンシプル

@ul[squares]

- コードの臭い
- 技術的負債

@ulend

---

- コードの臭い
- 技術的負債

数あるプリンシプルの中でも耳にする機会の多い２つかと思います。

今回はより具体的なケース（場面）をあげて、  
**「私がそれぞれのプリンシプルをどのように活用しているか」**  
を紹介していきます。

---

（紹介に入る前に）

## <font color="yellow">留意点</font>

- あくまでもプリンシプルを使える場面の「一例」
  - プリンシプル自体はもっと活用機会多い
- これだけ知っていれば「誰でもレビュアになれる」というわけではない  
  - どうしても言語・フレームワーク・PJに依存する部分はある

---

# 本題

---

## プリンシプルを用いたレビューの流れ

@ul[squares]

1. 「コードの臭い」を感じ取り指摘を入れる
2. （「原則」に基づき "あるべき姿" を導き出す）
3. **対応方針を「技術的負債」の考え方を用いて検討する**

@ulend

---

### 1. 「コードの臭い」を感じ取り指摘を入れる

---

## コードの臭いとは何か？

---

### コードの凶兆を見逃さない

### 嗅覚はリファクタリングの必要条件

---

### 臭いの傾向を知る

|観点|チェック内容|
|:--:|:--|
|よく見る|同じ処理を複数箇所に記載していないか？
|大きすぎる|１つの処理が担う役割（仕事量）が大きすぎないか？
|長すぎる|
|名前が合わない|処理名と内容が一致しているか？<br>似た処理の命名ルールが揃っているか？

---

### 2. （「原則」に基づき "あるべき姿" を導き出す）

---

### 3. **対応方針を「技術的負債」の考え方を用いて検討する**

---

## 技術的負債とは何か？


---

### 問題コードは「借金」である

### 問題コードとうまく付き合う方法

### 問題コードを管理する

### コードをきれいにする意義を説明

---

### 問題コードの誘因

---

#### 要素

- 経験不足のプログラマ
- 締め切りのフレッシャー
- 読みにくいコード
- 特殊化されたコード
- 不要に複雑なコード
- 単に悪い設計

---

#### チームの文化

- きれいなコードを書こうとしない
- 不明瞭なコードがあっても受け入れてしまう
- リファクタリングに時間を割かない
- リリース直前になって回帰テストを実行する
- 膨大な依存性を抱えた古いシステムのリプレースを躊躇する
- 安易にコードをブランチさせる

### 関連： 暫定ソリューション

よくある「暫定対応」

急ぎでやるので本来守るべき規約やガイドラインに従うことができていないことが多い

→ 「あとで直す」という前提で進めているところが多いはず

---

ところが、暫定ソリューションには「慣性の法則」が働く

@ul[squares]

- 今動いている
- 一応役になっている
- 一応みんなに認められている

@ulend

などの理由で「直す必要性」を感じられず今すぐ変えようと動き出さず、  
結果 **「その場しのぎ」のはずのコードが長生きする** （既成事実と化す）  

---

とはいえ暫定ソリューションを初めから一切作らない、というのは現実的に無理
（問題解決間に合わない、とかどうしても起きる）

→ 技術的負債と同様に管理してあげて、原則「素早く直す」こと
（障害とかが発生した直後が一番。担当者離任とかのリスクもあるし）

---

## まとめ

---

原則に基づいて最適なコードを書くことが、  
「息の長いコードを残す」ためには必要。

@ul[squares]

- とはいえ現実問題常に完璧なコードを書くことは不可能
  - スキル不足、考慮漏れ、古くからの負債
- 負債との付き合い方（管理・解消する仕組み作り）が大事

@ulend

---

### 「原則」について

# しっかりした価値観を持て

（「SEを極める50の鉄則」より）

---

> 第一線のSEはしっかりとした考え方・価値観を持たなければならない

@ul[squares]

- 若い時の経験がカギ
- 普遍的な価値観を身に付けよ

@ulend

---

> 第一線のSEはしっかりとした考え方・価値観を持たなければならない

- 若い時の経験がカギ
- <font color="red">普遍的な価値観を身に付けよ</font>

---

言語やフレームワークについての学習はもちろん必要

ただし、


---

### <div style="text-align: center;">ご静聴ありがとうございました</font>

---

#### 参考書籍

- [プリンシプル オブ プログラミング 3年目までに身につけたい 一生役立つ101の原理原則](https://www.amazon.co.jp/dp/B071V7MY82)
- [新装版 リファクタリング―既存のコードを安全に改善する―](https://www.amazon.co.jp/dp/427405019X)
- [SEを極める50の鉄則](https://www.amazon.co.jp/dp/4822207773)